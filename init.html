<!DOCTYPE html>
<html>
   <head>
      <meta charset = "UTF-8">
      <meta http-equiv = "X-UA-Compatible" content = "IE = edge,chrome = 1">
      <title>Hello World using Backbone.js</title>
   </head>
   
   <body id="body">
      <!-- ========= -->
      <!-- Your HTML -->
      <!-- ========= -->


      <a id="list" href = "#list">Listar </a>
      <a id="save" href = "#new">Nuevo </a>
      <a id="update" href = "route3">Route3 </a>
      <div id="#jsGrid"></div>


      <!-- ========= -->
      <!-- Libraries -->
      <!-- ========= -->
      <script src = "https://code.jquery.com/jquery-2.1.3.min.js" type = "text/javascript"></script>
         
      <script src = "https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore.js" type = "text/javascript"></script>
         

      <script src = "https://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.3.3/backbone.js" type = "text/javascript"></script>
      <!-- =============== -->
      <!-- Javascript code -->
      <!-- =============== -->
      <link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid.min.css" />
      <link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid-theme.min.css" />
       

      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid.min.js"></script>
      
      <script type = "text/javascript">

      //'Router' is a name of the router class
      var Router = Backbone.Router.extend ({
         routes: {
              'list': 'list',
              'new': 'new'
         },

          list: function(){
              listUsers();
          },
          new: function () {
               newUser();
          }
      });

      //'router' is an instance of the Router
      var router = new Router();

      //Start listening to the routes and manages the history for bookmarkable URL's
      Backbone.history.start();

         var User = Backbone.Model.extend({
            defaults:{
               id: null,
               email: null,
               firstname: null,
               secondname: null,
               lastname: null,
               secondlastname: null,
               password: null,
               roles: null
            },
            url: 'http://localhost/rentbike/web/app_dev.php/user',
            initialize: function(){
               // TODO: acciones de inicializaci칩n del modelo
            }
         });

         var UserCollection = Backbone.Collection.extend({
            model: User,
            url: function() {
               return 'http://localhost/rentbike/web/app_dev.php/user';
            },
            initialize: function(){
               // TODO: acciones de inicializaci칩n del modelo
            }
         });


         NewUserView = Backbone.View.extend({
             //template: _.template($('#ficha_template').html()),
             render: function(){
                 
               var div = $('<div></div>');

               var form = $('<form></form>');

               

               var fields = [];


               var firstname = '<input type="text" id="firstname-user"></input>';
               var secondname = '<input type="text" id="secondname-user"></input>';
               var lastname = '<input type="text" id="lastname-user"></input>';
               var secondlastname = '<input type="text" id="secondlastname-user"></input>';
               var password = '<input type="password" id="password-user"></input>';

               fields.push(firstname);
               fields.push(secondname);
               fields.push(lastname);
               fields.push(secondlastname);
               fields.push(password);

               for (var i = 0; i < fields.length; i++) {
                  var field = fields[i];
                  var formgroup = $('<div class="form-group"></div>');
                  formgroup.append(field);

                  form.append(formgroup);   
               }


               div.append(form);

               $(this.el).append(div);

               return this;

             }
         });
         var ficha = new NewUserView({el:$('body')});

         ficha.render();


         function listUsers () {

            $('#body').append('<div id="jsGrid"></div>');

            $("#jsGrid").jsGrid({
              height: "auto",
              width: "100%",
              sorting: true,
              paging: false,
              autoload: true,
              controller: {
                  loadData: function() {
                      var d = $.Deferred();

                      $.ajax({
                          url: "http://localhost/rentbike/web/app_dev.php/user/list",
                          dataType: "json"
                      }).done(function(response) {
                          d.resolve(response.data);
                      });

                      return d.promise();
                  }
              },
              fields: [
                  {
                     name: "firstname", 
                     type: "text"
                  },
                  {
                     name: "lastname", 
                     type: "text"
                  },
                  {
                     name: "email", 
                     type: "text"
                  },
              ]
            });

         }



         $('#btn-add-user').click(function (argument) {
            newUser();
         });

         function newUser(argument) {
            
         }

         // function newUser(argument) {

         //    $('#new-user').show();


         //    /*console.log('Crear Usuario');
         //    var newUser = new User({
         //       "email":"pepito@gmail.com",
         //       "firstname":"Pepito",
         //       "lastname":"Perez",
         //       "password": "12345"
         //       }
         //    );

         //    libroNuevo.save();
         //    coleccion_libros.add(newUser);*/




         // }

      </script>

    <!--   <div id="new-user" style="display: none">
                <form id="form-user">
                  <div class="form-group">
                     <label for="name">Nombre</label>
                     <input type="name" class="form-control" id="name" placeholder="Nombre" required>
                  </div>
                  <div class="form-group">
                     <label for="lastname">Apellido</label>
                     <input type="lastname" class="form-control" id="lastname" placeholder="Apellido" required>
                  </div>
                  <div class="form-group">
                     <label for="Tipo">Tipo</label>
                     <select id="type" required>
                        <option value="ADMIN">Administrador</option>
                        <option value="DESPACHADOR">Despachador</option>
                     </select>
                  </div>
                  <div class="form-group">
                     <label for="email">Email</label>
                     <input type="email" class="form-control" id="email" placeholder="Email" required>
                  </div>
                  <div class="form-group">
                     <label for="password">Contrase침a</label>
                     <input type="password" class="form-control" id="password" placeholder="Contrase침a" required>
                  </div>
                 </form>
               <div class="modal-footer">
                 <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                 <button type="submit" class="btn btn-primary" onclick="addUser()">Guardar</button>
               </div>
      </div>  -->


   </body>
</html>